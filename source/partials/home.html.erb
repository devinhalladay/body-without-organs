<% projects = blog.articles %>

<section id="contents" class="layer-2<% if locals[:inactive] %> inactive<% end %>">
  <div class="border"></div>
  <div class="wrapper">
    <header>
      <h1>
        <a href="/"><%= data.site.title %></a>
      </h1>
    </header>

    <ul class="index">
      <% blog.tags.sort_by{|term, items| items.length}.reverse.each do |term, items| %>
        <li class="term">
          <a href><%= term.split.map(&:capitalize)*' ' %></a>
          <ul class="term-items">
            <% items.each_with_index do |item, index| %>
              <li>
                <a href="<%= item.url %>">
                  <% if item.data.image %>
                    <span class="link-thumbnail"><img src="<%= item.data.image %>" alt="<%= item.title %>"></span>
                  <% end %>
                  <span class="link-title"><%= item.title %></span>
                </a>
              </li>
            <% end %>
          </ul>
        </li>
      <% end %>
    </ul>
    <div id="timeline"></div>
    <div class="popover"></div>
  </div>
</section>

<script>
  var now = moment().minutes(0).seconds(0).milliseconds(0);
  var itemCount = 20;

  // create a data set with groups
  // var names = ['John', 'Alston', 'Lee', 'Grant'];
  var names = <%= blog.tags.keys %>;
  var groupCount = names.length;
  var groups = new vis.DataSet();
  for (var g = 0; g < groupCount; g++) {
    groups.add({id: g, content: names[g]});
  }

  var groupArray = [
    <% blog.tags.keys.each_with_index do |tag, index| %>
    {
      group: <%= index %>,
      tagName: '<%= tag.downcase %>'
    },
    <% end %>
  ]

  // create a dataset with items
  var items = new vis.DataSet([
    <% blog.articles.each_with_index do |item, index| %>
    {
      id: <%= index %>,
      group: <%= blog.tags.keys.index(item.tags.first) %>,
      content: '<a href="<%= item.url %>"><%= item.title %></a>',
      start: '<%= item.date.strftime('%Y-%m-%d') %>',
      type: 'box'
    },
    <% end %>
  ]);

  // create visualization
  var container = document.getElementById('timeline');
  var options = {
    groupOrder: 'content',  // groupOrder can be a property name or a sorting function
    zoomMax: 2592000000,
    zoomMin: 345600000,
  };

  var timeline = new vis.Timeline(container);
  timeline.setOptions(options);
  timeline.setGroups(groups);
  timeline.setItems(items);

</script>
